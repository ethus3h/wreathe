#!/bin/bash
#Ember Offline Git UPdater for single repository
source ember_bash_setup &> /dev/null

trap 'die "A fatal error was reported on ${BASH_SOURCE[0]} line ${LINENO}."' ERR
#set -x

cd "$1" || exit 1

egup-env

branch="$(git branch | grep -E "^\* " | cut -c 3-)"
git checkout "$branch"
git add -A
git add -A .
set +e
git commit -a -m "Update Ember tree"
set -e
if [[ -f .egup.hooks ]]; then
    echo "Beginning running hooks..."
    ./.egup.hooks || warn "WARNING! pre-build-hooks failed; continuing anyway."
    echo "Done running hooks."
    set +e
    git commit -a -m "Update Ember tree"
    set -e
fi
git show-ref -d --tags > .egup.tags || echo "(Note: Repository appears to have no tags.)"
git add -A
set +e
git commit -a -m "Update Ember tree"
set -e

egup-exit
