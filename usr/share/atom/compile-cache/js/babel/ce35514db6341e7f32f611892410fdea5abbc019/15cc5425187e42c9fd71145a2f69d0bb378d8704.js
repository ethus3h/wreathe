Object.defineProperty(exports, '__esModule', {
  value: true
});

/* eslint-disable import/extensions, import/no-extraneous-dependencies */

var _atom = require('atom');

/* eslint-enable import/extensions, import/no-extraneous-dependencies */

'use babel';var helpers = null;
var path = null;

exports['default'] = {
  activate: function activate() {
    var _this = this;

    require('atom-package-deps').install('linter-csslint');

    this.subscriptions = new _atom.CompositeDisposable();
    this.subscriptions.add(atom.config.observe('linter-csslint.disableTimeout', function (value) {
      _this.disableTimeout = value;
    }));
  },

  deactivate: function deactivate() {
    this.subscriptions.dispose();
  },

  provideLinter: function provideLinter() {
    return {
      name: 'CSSLint',
      grammarScopes: ['source.css', 'source.html'],
      scope: 'file',
      lintOnFly: true,
      lint: function lint(textEditor) {
        if (!helpers) {
          helpers = require('atom-linter');
        }
        if (!path) {
          path = require('path');
        }
        var filePath = textEditor.getPath();
        var text = textEditor.getText();
        if (text.length === 0) {
          return Promise.resolve([]);
        }
        var parameters = ['--format=json', '-'];
        var exec = path.join(__dirname, '..', 'node_modules', 'atomlinter-csslint', 'cli.js');
        var projectPath = atom.project.relativizePath(filePath)[0];
        var cwd = projectPath;
        if (!cwd) {
          cwd = path.dirname(filePath);
        }
        var options = { stdin: text, cwd: cwd };
        if (this.disableTimeout) {
          options.timeout = Infinity;
        }
        return helpers.execNode(exec, parameters, options).then(function (output) {
          if (textEditor.getText() !== text) {
            // The editor contents have changed, tell Linter not to update
            return null;
          }

          var toReturn = [];
          if (output.length < 1) {
            // No output, no errors
            return toReturn;
          }

          var lintResult = JSON.parse(output);

          if (lintResult.messages.length < 1) {
            // Output, but no errors found
            return toReturn;
          }

          lintResult.messages.forEach(function (data) {
            var line = undefined;
            var col = undefined;
            if (!(data.line && data.col)) {
              line = 0;

              // Use the file start if a location wasn't defined
              col = 0;
            } else {
              line = data.line - 1;
              col = data.col - 1;
            }

            var msg = {
              type: data.type.charAt(0).toUpperCase() + data.type.slice(1),
              text: data.message,
              filePath: filePath,
              range: helpers.generateRange(textEditor, line, col)
            };

            if (data.rule.id && data.rule.desc) {
              msg.trace = [{
                type: 'Trace',
                text: '[' + data.rule.id + '] ' + data.rule.desc
              }];
            }
            toReturn.push(msg);
          });
          return toReturn;
        });
      }
    };
  }
};
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9saWJyYXJ5L0VtYmVyIHNhdGVsbGl0ZSBwcm9qZWN0cy93cmVhdGhlL3Vzci9zaGFyZS9hdG9tL3BhY2thZ2VzL2xpbnRlci1jc3NsaW50L2xpYi9tYWluLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztvQkFHb0MsTUFBTTs7OztBQUgxQyxXQUFXLENBQUMsQUFNWixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFDbkIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDOztxQkFFRDtBQUNiLFVBQVEsRUFBQSxvQkFBRzs7O0FBQ1QsV0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7O0FBRXZELFFBQUksQ0FBQyxhQUFhLEdBQUcsK0JBQXlCLENBQUM7QUFDL0MsUUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQ3BCLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLCtCQUErQixFQUFFLFVBQUMsS0FBSyxFQUFLO0FBQzlELFlBQUssY0FBYyxHQUFHLEtBQUssQ0FBQztLQUM3QixDQUFDLENBQ0gsQ0FBQztHQUNIOztBQUVELFlBQVUsRUFBQSxzQkFBRztBQUNYLFFBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLENBQUM7R0FDOUI7O0FBRUQsZUFBYSxFQUFBLHlCQUFHO0FBQ2QsV0FBTztBQUNMLFVBQUksRUFBRSxTQUFTO0FBQ2YsbUJBQWEsRUFBRSxDQUFDLFlBQVksRUFBRSxhQUFhLENBQUM7QUFDNUMsV0FBSyxFQUFFLE1BQU07QUFDYixlQUFTLEVBQUUsSUFBSTtBQUNmLFVBQUksRUFBQSxjQUFDLFVBQVUsRUFBRTtBQUNmLFlBQUksQ0FBQyxPQUFPLEVBQUU7QUFDWixpQkFBTyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztTQUNsQztBQUNELFlBQUksQ0FBQyxJQUFJLEVBQUU7QUFDVCxjQUFJLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3hCO0FBQ0Qs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SUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLFVBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEFBQUU7ZUFDNUMsQ0FBQyxDQUFDO2FBQ0o7QUFDRCxvQkFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztXQUNwQixDQUFDLENBQUM7QUFDSCxpQkFBTyxRQUFRLENBQUM7U0FDakIsQ0FBQyxDQUFDO09BQ0o7S0FDRixDQUFDO0dBQ0g7Q0FDRiIsImZpbGUiOiIvbGlicmFyeS9FbWJlciBzYXRlbGxpdGUgcHJvamVjdHMvd3JlYXRoZS91c3Ivc2hhcmUvYXRvbS9wYWNrYWdlcy9saW50ZXItY3NzbGludC9saWIvbWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSBpbXBvcnQvZXh0ZW5zaW9ucywgaW1wb3J0L25vLWV4dHJhbmVvdXMtZGVwZW5kZW5jaWVzICovXG5pbXBvcnQgeyBDb21wb3NpdGVEaXNwb3NhYmxlIH0gZnJvbSAnYXRvbSc7XG4vKiBlc2xpbnQtZW5hYmxlIGltcG9ydC9leHRlbnNpb25zLCBpbXBvcnQvbm8tZXh0cmFuZW91cy1kZXBlbmRlbmNpZXMgKi9cblxubGV0IGhlbHBlcnMgPSBudWxsO1xubGV0IHBhdGggPSBudWxsO1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gIGFjdGl2YXRlKCkge1xuICAgIHJlcXVpcmUoJ2F0b20tcGFja2FnZS1kZXBzJykuaW5zdGFsbCgnbGludGVyLWNzc2xpbnQnKTtcblxuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IG5ldyBDb21wb3NpdGVEaXNwb3NhYmxlKCk7XG4gICAgdGhpcy5zdWJzY3JpcHRpb25zLmFkZChcbiAgICAgIGF0b20uY29uZmlnLm9ic2VydmUoJ2xpbnRlci1jc3NsaW50LmRpc2FibGVUaW1lb3V0JywgKHZhbHVlKSA9PiB7XG4gICAgICAgIHRoaXMuZGlzYWJsZVRpbWVvdXQgPSB2YWx1ZTtcbiAgICAgIH0pLFxuICAgICk7XG4gIH0sXG5cbiAgZGVhY3RpdmF0ZSgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZGlzcG9zZSgpO1xuICB9LFxuXG4gIHByb3ZpZGVMaW50ZXIoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6ICdDU1NMaW50JyxcbiAgICAgIGdyYW1tYXJTY29wZXM6IFsnc291cmNlLmNzcycsICdzb3VyY2UuaHRtbCddLFxuICAgICAgc2NvcGU6ICdmaWxlJyxcbiAgICAgIGxpbnRPbkZseTogdHJ1ZSxcbiAgICAgIGxpbnQodGV4dEVkaXRvcikge1xuICAgICAgICBpZiAoIWhlbHBlcnMpIHtcbiAgICAgICAgICBoZWxwZXJzID0gcmVxdWlyZSgnYXRvbS1saW50ZXInKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgICBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZpbGVQYXRoID0gdGV4dEVkaXRvci5nZXRQYXRoKCk7XG4gICAgICAgIGNvbnN0IHRleHQgPSB0ZXh0RWRpdG9yLmdldFRleHQoKTtcbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShbXSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFyYW1ldGVycyA9IFsnLS1mb3JtYXQ9anNvbicsICctJ107XG4gICAgICAgIGNvbnN0IGV4ZWMgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4nLCAnbm9kZV9tb2R1bGVzJywgJ2F0b21saW50ZXItY3NzbGludCcsICdjbGkuanMnKTtcbiAgICAgICAgY29uc3QgcHJvamVjdFBhdGggPSBhdG9tLnByb2plY3QucmVsYXRpdml6ZVBhdGgoZmlsZVBhdGgpWzBdO1xuICAgICAgICBsZXQgY3dkID0gcHJvamVjdFBhdGg7XG4gICAgICAgIGlmICghKGN3ZCkpIHtcbiAgICAgICAgICBjd2QgPSBwYXRoLmRpcm5hbWUoZmlsZVBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7IHN0ZGluOiB0ZXh0LCBjd2QgfTtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZVRpbWVvdXQpIHtcbiAgICAgICAgICBvcHRpb25zLnRpbWVvdXQgPSBJbmZpbml0eTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaGVscGVycy5leGVjTm9kZShleGVjLCBwYXJhbWV0ZXJzLCBvcHRpb25zKS50aGVuKChvdXRwdXQpID0+IHtcbiAgICAgICAgICBpZiAodGV4dEVkaXRvci5nZXRUZXh0KCkgIT09IHRleHQpIHtcbiAgICAgICAgICAgIC8vIFRoZSBlZGl0b3IgY29udGVudHMgaGF2ZSBjaGFuZ2VkLCB0ZWxsIExpbnRlciBub3QgdG8gdXBkYXRlXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB0b1JldHVybiA9IFtdO1xuICAgICAgICAgIGlmIChvdXRwdXQubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgLy8gTm8gb3V0cHV0LCBubyBlcnJvcnNcbiAgICAgICAgICAgIHJldHVybiB0b1JldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCBsaW50UmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuXG4gICAgICAgICAgaWYgKGxpbnRSZXN1bHQubWVzc2FnZXMubGVuZ3RoIDwgMSkge1xuICAgICAgICAgICAgLy8gT3V0cHV0LCBidXQgbm8gZXJyb3JzIGZvdW5kXG4gICAgICAgICAgICByZXR1cm4gdG9SZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGludFJlc3VsdC5tZXNzYWdlcy5mb3JFYWNoKChkYXRhKSA9PiB7XG4gICAgICAgICAgICBsZXQgbGluZTtcbiAgICAgICAgICAgIGxldCBjb2w7XG4gICAgICAgICAgICBpZiAoIShkYXRhLmxpbmUgJiYgZGF0YS5jb2wpKSB7XG4gICAgICAgICAgICAgIC8vIFVzZSB0aGUgZmlsZSBzdGFydCBpZiBhIGxvY2F0aW9uIHdhc24ndCBkZWZpbmVkXG4gICAgICAgICAgICAgIFtsaW5lLCBjb2xdID0gWzAsIDBdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgW2xpbmUsIGNvbF0gPSBbZGF0YS5saW5lIC0gMSwgZGF0YS5jb2wgLSAxXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgbXNnID0ge1xuICAgICAgICAgICAgICB0eXBlOiBkYXRhLnR5cGUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkYXRhLnR5cGUuc2xpY2UoMSksXG4gICAgICAgICAgICAgIHRleHQ6IGRhdGEubWVzc2FnZSxcbiAgICAgICAgICAgICAgZmlsZVBhdGgsXG4gICAgICAgICAgICAgIHJhbmdlOiBoZWxwZXJzLmdlbmVyYXRlUmFuZ2UodGV4dEVkaXRvciwgbGluZSwgY29sKSxcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChkYXRhLnJ1bGUuaWQgJiYgZGF0YS5ydWxlLmRlc2MpIHtcbiAgICAgICAgICAgICAgbXNnLnRyYWNlID0gW3tcbiAgICAgICAgICAgICAgICB0eXBlOiAnVHJhY2UnLFxuICAgICAgICAgICAgICAgIHRleHQ6IGBbJHtkYXRhLnJ1bGUuaWR9XSAke2RhdGEucnVsZS5kZXNjfWAsXG4gICAgICAgICAgICAgIH1dO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdG9SZXR1cm4ucHVzaChtc2cpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB0b1JldHVybjtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgIH07XG4gIH0sXG59O1xuIl19