Object.defineProperty(exports, '__esModule', {
  value: true
});
exports['default'] = renameFile;

var _fsPlus = require('fs-plus');

/*
  code pulled from:
  https://github.com/atom/tree-view/blob/492e344149bd42755d90765607743173bb9b7c0a/lib/move-dialog.coffee
*/

'use babel';

function isNewPathValid(previousPath, nextPath) {
  if (!(0, _fsPlus.isFileSync)(nextPath)) return true;

  /*
  New path exists so check if it points to the same file as the initial
  path to see if the case of the file name is being changed on a on a
  case insensitive filesystem.
  */
  var oldStat = (0, _fsPlus.statSync)(previousPath);
  var newStat = (0, _fsPlus.statSync)(nextPath);
  var haveSamePath = previousPath.toLowerCase() === nextPath.toLowerCase();
  var haveSameDev = oldStat.dev === newStat.dev;
  var haveSameIno = oldStat.ino === newStat.ino;

  return !(haveSamePath && haveSameDev && haveSameIno);
}

function renameFile(previousPath, nextPath) {
  if (!isNewPathValid(previousPath, nextPath)) return false;

  try {
    (0, _fsPlus.moveSync)(previousPath, nextPath);
    return true;
  } catch (e) {
    atom.notifications.addError(e.message, {
      dismissable: true
    });
    return false;
  }
}

module.exports = exports['default'];
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9saWJyYXJ5L0VtYmVyIHNhdGVsbGl0ZSBwcm9qZWN0cy93cmVhdGhlLWJhc2UvdXNyL3NoYXJlL2F0b20vcGFja2FnZXMvamF2YXNjcmlwdC1yZWZhY3Rvci9saWIvdXRpbHMvcmVuYW1lRmlsZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7cUJBMEJ3QixVQUFVOztzQkF4QmEsU0FBUzs7Ozs7OztBQUZ4RCxXQUFXLENBQUM7O0FBU1osU0FBUyxjQUFjLENBQUMsWUFBWSxFQUFFLFFBQVEsRUFBRTtBQUM5QyxNQUFJLENBQUMsd0JBQVcsUUFBUSxDQUFDLEVBQUUsT0FBTyxJQUFJLENBQUM7Ozs7Ozs7QUFPdkMsTUFBTSxPQUFPLEdBQUcsc0JBQVMsWUFBWSxDQUFDLENBQUM7QUFDdkMsTUFBTSxPQUFPLEdBQUcsc0JBQVMsUUFBUSxDQUFDLENBQUM7QUFDbkMsTUFBTSxZQUFZLEdBQUcsWUFBWSxDQUFDLFdBQVcsRUFBRSxLQUFLLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztBQUMzRSxNQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsR0FBRyxLQUFLLE9BQU8sQ0FBQyxHQUFHLENBQUM7QUFDaEQsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLEdBQUcsS0FBSyxPQUFPLENBQUMsR0FBRyxDQUFDOztBQUVoRCxTQUFPLEVBQUUsWUFBWSxJQUFJLFdBQVcsSUFBSSxXQUFXLENBQUEsQUFBQyxDQUFDO0NBQ3REOztBQUVjLFNBQVMsVUFBVSxDQUFDLFlBQVksRUFBRSxRQUFRLEVBQUU7QUFDekQsTUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLEVBQUUsUUFBUSxDQUFDLEVBQUUsT0FBTyxLQUFLLENBQUM7O0FBRTFELE1BQUk7QUFDRiwwQkFBUyxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDakMsV0FBTyxJQUFJLENBQUM7R0FDYixDQUFDLE9BQU8sQ0FBQyxFQUFFO0FBQ1YsUUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRTtBQUNyQyxpQkFBVyxFQUFFLElBQUk7S0FDbEIsQ0FBQyxDQUFDO0FBQ0gsV0FBTyxLQUFLLENBQUM7R0FDZDtDQUNGIiwiZmlsZSI6Ii9saWJyYXJ5L0VtYmVyIHNhdGVsbGl0ZSBwcm9qZWN0cy93cmVhdGhlLWJhc2UvdXNyL3NoYXJlL2F0b20vcGFja2FnZXMvamF2YXNjcmlwdC1yZWZhY3Rvci9saWIvdXRpbHMvcmVuYW1lRmlsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2UgYmFiZWwnO1xuXG5pbXBvcnQgeyBpc0ZpbGVTeW5jLCBtb3ZlU3luYywgc3RhdFN5bmMgfSBmcm9tICdmcy1wbHVzJztcblxuLypcbiAgY29kZSBwdWxsZWQgZnJvbTpcbiAgaHR0cHM6Ly9naXRodWIuY29tL2F0b20vdHJlZS12aWV3L2Jsb2IvNDkyZTM0NDE0OWJkNDI3NTVkOTA3NjU2MDc3NDMxNzNiYjliN2MwYS9saWIvbW92ZS1kaWFsb2cuY29mZmVlXG4qL1xuXG5mdW5jdGlvbiBpc05ld1BhdGhWYWxpZChwcmV2aW91c1BhdGgsIG5leHRQYXRoKSB7XG4gIGlmICghaXNGaWxlU3luYyhuZXh0UGF0aCkpIHJldHVybiB0cnVlO1xuXG4gIC8qXG4gIE5ldyBwYXRoIGV4aXN0cyBzbyBjaGVjayBpZiBpdCBwb2ludHMgdG8gdGhlIHNhbWUgZmlsZSBhcyB0aGUgaW5pdGlhbFxuICBwYXRoIHRvIHNlZSBpZiB0aGUgY2FzZSBvZiB0aGUgZmlsZSBuYW1lIGlzIGJlaW5nIGNoYW5nZWQgb24gYSBvbiBhXG4gIGNhc2UgaW5zZW5zaXRpdmUgZmlsZXN5c3RlbS5cbiAgKi9cbiAgY29uc3Qgb2xkU3RhdCA9IHN0YXRTeW5jKHByZXZpb3VzUGF0aCk7XG4gIGNvbnN0IG5ld1N0YXQgPSBzdGF0U3luYyhuZXh0UGF0aCk7XG4gIGNvbnN0IGhhdmVTYW1lUGF0aCA9IHByZXZpb3VzUGF0aC50b0xvd2VyQ2FzZSgpID09PSBuZXh0UGF0aC50b0xvd2VyQ2FzZSgpO1xuICBjb25zdCBoYXZlU2FtZURldiA9IG9sZFN0YXQuZGV2ID09PSBuZXdTdGF0LmRldjtcbiAgY29uc3QgaGF2ZVNhbWVJbm8gPSBvbGRTdGF0LmlubyA9PT0gbmV3U3RhdC5pbm87XG5cbiAgcmV0dXJuICEoaGF2ZVNhbWVQYXRoICYmIGhhdmVTYW1lRGV2ICYmIGhhdmVTYW1lSW5vKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmVuYW1lRmlsZShwcmV2aW91c1BhdGgsIG5leHRQYXRoKSB7XG4gIGlmICghaXNOZXdQYXRoVmFsaWQocHJldmlvdXNQYXRoLCBuZXh0UGF0aCkpIHJldHVybiBmYWxzZTtcblxuICB0cnkge1xuICAgIG1vdmVTeW5jKHByZXZpb3VzUGF0aCwgbmV4dFBhdGgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgYXRvbS5ub3RpZmljYXRpb25zLmFkZEVycm9yKGUubWVzc2FnZSwge1xuICAgICAgZGlzbWlzc2FibGU6IHRydWUsXG4gICAgfSk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG4iXX0=