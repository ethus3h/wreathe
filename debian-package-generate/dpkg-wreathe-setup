#!/usr/bin/env bash
#set -x

((EUID)) && exec sudo -- "$0" "$@"
trap 'printf '\''%b'\'' '\''\033[1;31m'\'' >&2; echo "A fatal error was reported on ${BASH_SOURCE[0]} line ${LINENO} in $(pwd)." >&2; printf '\''%b'\'' '\''\033[0m'\'' >&2; exit 1' ERR

# shellcheck disable=SC1091
source ./targets &> /dev/null

pip install internetarchive

(
    mkdir -p /var/ember-wreathe-packages-repository
    cd /var/ember-wreathe-packages-repository
    ia download Wreathe-GNU-Linux-Multisystem-Packages --glob='*.deb'
    dpkg -i ./Wreathe-GNU-Linux-Multisystem-Packages/*.deb
)
